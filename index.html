<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WÃ¶rter-RÃ¤tsel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f8ff;
        }
        
        .header {
            text-align: center;
            color: #2c5aa0;
            margin-bottom: 30px;
        }
        
        .exercise {
            background: white;
            padding: 25px;
            margin: 20px 0;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .text-content {
            flex: 1;
            min-width: 300px;
        }
        
        .sentence {
            font-size: 1.3em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 15px;
            white-space: pre-wrap;
        }
        
        .text-input {
            padding: 8px 12px;
            font-size: 1.1em;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            min-width: 120px;
            text-align: center;
            background-color: #f9f9f9;
        }
        
        .text-input:focus {
            outline: none;
            background-color: white;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
        }
        
        .text-input::placeholder {
            color: transparent;
        }
        
        .image-container {
            flex-shrink: 0;
        }
        
        .hint-image, .hint-svg {
            width: 200px;
            height: 150px;
            border: 3px solid #ddd;
            border-radius: 10px;
            object-fit: cover;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .emoji-container {
            width: 200px;
            height: 150px;
            border: 3px solid #ddd;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .emoji-hint {
            font-size: 64px;
            line-height: 1;
        }
        
        .check-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        
        .check-button:hover {
            background-color: #45a049;
        }
        
        .speak-button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 10px 15px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        
        .speak-button:hover {
            background-color: #1976D2;
        }
        
        .feedback {
            margin-top: 10px;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .correct {
            color: #4CAF50;
        }
        
        .incorrect {
            color: #f44336;
        }
        
        .difficulty-selector {
            background: white;
            padding: 15px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .difficulty-selector label {
            cursor: pointer;
            font-size: 1.1em;
        }
        
        .difficulty-selector input[type="radio"] {
            margin-right: 5px;
            transform: scale(1.2);
        }
        
        .score {
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: #2c5aa0;
            margin-top: 30px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .exercise {
                flex-direction: column;
                text-align: center;
            }
            
            .hint-image {
                width: 150px;
                height: 112px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸš— WÃ¶rter-RÃ¤tsel ðŸš—</h1>
        <p>Bei jedem Start werden 10 zufÃ¤llige Aufgaben gezeigt. FÃ¼lle die LÃ¼cken aus â€“ Emojis helfen dir.</p>
    </div>

    <div class="difficulty-selector">
        <div style="text-align: center; margin: 20px 0;">
            <label style="font-size: 1.1em; font-weight: bold; color: #2c5aa0; margin-right: 15px;">Schwierigkeit:</label>
            <label style="margin-right: 15px;">
                <input type="radio" name="difficulty" value="normal" checked onchange="changeDifficulty()"> 
                <span style="margin-left: 5px;">Normal</span>
            </label>
            <label>
                <input type="radio" name="difficulty" value="schwer" onchange="changeDifficulty()"> 
                <span style="margin-left: 5px;">Schwer</span>
            </label>
        </div>
    </div>

    <div class="score">
        Punkte: <span id="score">0</span> / <span id="total">10</span>
        <div style="margin-top:10px;">
            <button class="check-button" onclick="checkAll()">Alles prÃ¼fen</button>
            <button class="speak-button" onclick="newRound()">Neu starten</button>
        </div>
    </div>

    <div id="exercises"></div>

    <script src="sentences.js"></script>
    <script>
        // Alle SÃ¤tze werden aus der externen JavaScript-Datei geladen
        let SENTENCES = [];
        let currentDifficulty = 'normal';

        // Funktion zum Laden der SÃ¤tze basierend auf der Schwierigkeit
        function loadSentences() {
            if (window.SENTENCES_DATA && window.SENTENCES_DATA[currentDifficulty]) {
                SENTENCES = window.SENTENCES_DATA[currentDifficulty];
                console.log(`${SENTENCES.length} ${currentDifficulty} SÃ¤tze aus sentences.js geladen`);
            } else {
                // Fallback: Ein paar BeispielsÃ¤tze falls die externe Datei nicht geladen wurde
                console.log('Fallback-SÃ¤tze geladen - sentences.js nicht verfÃ¼gbar');
                SENTENCES = [
                    {
                        pre: "Wenn ",
                        answer: "er",
                        post: " die Hausaufgaben gemacht hat, darf er spielen.",
                        emoji: "ðŸ‘¦"
                    },
                    {
                        pre: "Weil es regnet, ",
                        answer: "bleiben",
                        post: " wir heute drinnen.",
                        emoji: "ï¿½ï¸"
                    }
                ];
            }
        }

        // Funktion zum Wechseln der Schwierigkeit
        function changeDifficulty() {
            const selectedDifficulty = document.querySelector('input[name="difficulty"]:checked').value;
            currentDifficulty = selectedDifficulty;
            
            // SÃ¤tze neu laden
            loadSentences();
            
            // Library zurÃ¼cksetzen, damit sie neu aufgebaut wird
            library = [];
            
            // Neue Runde starten
            newRound();
        }

        // Globaler Zustand
        let library = [];
        let selection = [];
        let correctAnswers = 0;
        const COUNT_PER_ROUND = 10;

        // Bibliothek mit IDs vorbereiten
        function buildLibrary() {
            return SENTENCES.map((s, i) => ({ id: i + 1, ...s }));
        }

        function pickRandom(arr, n) {
            const result = [];
            const used = new Set();
            while (result.length < n && used.size < arr.length) {
                const idx = Math.floor(Math.random() * arr.length);
                if (!used.has(idx)) {
                    used.add(idx);
                    result.push(arr[idx]);
                }
            }
            return result;
        }

        function renderExercises(items) {
            const container = document.getElementById('exercises');
            container.innerHTML = '';
            items.forEach((it, i) => {
                const wrap = document.createElement('div');
                wrap.className = 'exercise';

                const text = document.createElement('div');
                text.className = 'text-content';

                const sentence = document.createElement('div');
                sentence.className = 'sentence';
                const inputId = `answer-${i}`;
                const feedbackId = `feedback-${i}`;

                // Baue die Satzteile sicher als DOM-Knoten auf
                const preNode = document.createTextNode(it.pre ?? '');
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'text-input';
                input.id = inputId;
                input.setAttribute('placeholder', '');
                const postNode = document.createTextNode((it.post ?? ''));

                // Leerzeichen rund um das Eingabefeld sichern
                const space1 = document.createTextNode(' ');
                const space2 = document.createTextNode(' ');

                sentence.appendChild(preNode);
                sentence.appendChild(space1);
                sentence.appendChild(input);
                sentence.appendChild(space2);
                sentence.appendChild(postNode);

                const checkBtn = document.createElement('button');
                checkBtn.className = 'check-button';
                checkBtn.textContent = 'PrÃ¼fen';
                checkBtn.onclick = () => checkAnswer(i, it.answer);

                const speakBtn = document.createElement('button');
                speakBtn.className = 'speak-button';
                speakBtn.textContent = 'ðŸ”Š Vorlesen';
                speakBtn.onclick = () => speakWord(it.answer);

                const feedback = document.createElement('div');
                feedback.className = 'feedback';
                feedback.id = feedbackId;

                text.appendChild(sentence);
                text.appendChild(checkBtn);
                text.appendChild(speakBtn);
                text.appendChild(feedback);

                const hint = document.createElement('div');
                hint.className = 'emoji-container';
                hint.setAttribute('aria-label', 'Hinweis');
                const span = document.createElement('span');
                span.className = 'emoji-hint';
                span.setAttribute('role', 'img');
                span.textContent = it.emoji || 'ðŸ§©';
                hint.appendChild(span);

                wrap.appendChild(text);
                wrap.appendChild(hint);
                container.appendChild(wrap);
            });
        }

        function updateScore() {
            document.getElementById('score').textContent = String(correctAnswers);
            document.getElementById('total').textContent = String(selection.length);
            if (correctAnswers === selection.length && selection.length > 0) {
                setTimeout(() => alert('ðŸŽ‰ Super! Alle richtig gelÃ¶st!'), 300);
            }
        }

        function checkAnswer(idx, correct) {
            const input = document.getElementById(`answer-${idx}`);
            const feedback = document.getElementById(`feedback-${idx}`);
            if (!input || !feedback) return;

            const value = (input.value || '').trim();
            if (value === correct) {
                feedback.textContent = 'âœ… Richtig!';
                feedback.className = 'feedback correct';
                input.style.borderColor = '#4CAF50';
                input.style.backgroundColor = '#e8f5e9';
                if (!input.dataset.counted) {
                    correctAnswers++;
                    input.dataset.counted = '1';
                }
            } else {
                feedback.textContent = `âŒ Leider falsch. Tipp: ${correct.length} Buchstaben`;
                feedback.className = 'feedback incorrect';
                input.style.borderColor = '#f44336';
                input.style.backgroundColor = '#ffebee';
                if (input.dataset.counted) {
                    correctAnswers--;
                    input.dataset.counted = '';
                }
            }
            updateScore();
        }

        function checkAll() {
            selection.forEach((it, i) => checkAnswer(i, it.answer));
            document.querySelector('.score').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function newRound() {
            // Lade SÃ¤tze falls noch nicht geladen
            if (SENTENCES.length === 0) {
                loadSentences();
            }
            
            if (!library || library.length === 0) library = buildLibrary();
            correctAnswers = 0;
            
            // Anzahl der Fragen je nach Schwierigkeit und verfÃ¼gbaren SÃ¤tzen
            const maxQuestions = Math.min(COUNT_PER_ROUND, SENTENCES.length);
            selection = pickRandom(library, maxQuestions);
            renderExercises(selection);
            updateScore();
        }

        function speakWord(word) {
            if ('speechSynthesis' in window) {
                const u = new SpeechSynthesisUtterance(word);
                u.lang = 'de-DE';
                u.rate = 0.85;
                u.pitch = 1;
                window.speechSynthesis.speak(u);
            } else {
                alert('ðŸ”Š Das Wort ist: ' + word);
            }
        }

        // Enter-Taste: aktuelles Feld prÃ¼fen
        document.addEventListener('keypress', (event) => {
            if (event.key === 'Enter' && event.target.classList && event.target.classList.contains('text-input')) {
                const id = event.target.id;
                const idx = parseInt(id.split('-')[1], 10);
                const item = selection[idx];
                if (item) checkAnswer(idx, item.answer);
            }
        });

        // Erste Runde starten
        window.addEventListener('DOMContentLoaded', function() {
            loadSentences(); // Explizit SÃ¤tze laden
            newRound();
        });
    </script>
</body>
</html>

